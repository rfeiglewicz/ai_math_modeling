#ifndef BF16_EXP2_COEFFS_HPP
#define BF16_EXP2_COEFFS_HPP

#include <cstdint>

// =============================================================
// exp2(x) Linear Approximation Coefficients for BF16
// =============================================================
//
// Generated: 2025-12-27 15:34:54
// Interval:  [-0.99609375, -0.001953125]
// LUT Size:  128
//
// Approximation: y = a * x + b
//
// Error Metrics (BF16 ULP):
//   Worst-case: 0.499632 ULP
//   Average:    0.250104 ULP
// =============================================================

namespace bf16_exp2 {

constexpr int LUT_SIZE = 128;
constexpr float INTERVAL_START = -0.99609375f;
constexpr float INTERVAL_END = -0.001953125f;

// Slope coefficients (a)
static const float coeffs_a[LUT_SIZE] = {
     3.4798413601e-01f,  // Idx 0 ulp=0.3470
     3.4987365546e-01f,  // Idx 1 ulp=0.3938
     3.5177343481e-01f,  // Idx 2 ulp=0.2553
     3.5368352978e-01f,  // Idx 3 ulp=0.4492
     3.5560399637e-01f,  // Idx 4 ulp=0.4869
     3.5753489090e-01f,  // Idx 5 ulp=0.2272
     3.5947627001e-01f,  // Idx 6 ulp=0.4143
     3.6142819060e-01f,  // Idx 7 ulp=0.3330
     3.6339070994e-01f,  // Idx 8 ulp=0.3928
     3.6536388556e-01f,  // Idx 9 ulp=0.2428
     3.6734777533e-01f,  // Idx 10 ulp=0.4889
     3.6934243742e-01f,  // Idx 11 ulp=0.4060
     3.7134793033e-01f,  // Idx 12 ulp=0.3357
     3.7336431287e-01f,  // Idx 13 ulp=0.2920
     3.7539164417e-01f,  // Idx 14 ulp=0.4558
     3.7742998368e-01f,  // Idx 15 ulp=0.4150
     3.7947939117e-01f,  // Idx 16 ulp=0.3429
     3.8153992674e-01f,  // Idx 17 ulp=0.2766
     3.8361165081e-01f,  // Idx 18 ulp=0.4875
     3.8569462414e-01f,  // Idx 19 ulp=0.3585
     3.8778890781e-01f,  // Idx 20 ulp=0.4160
     3.8989456323e-01f,  // Idx 21 ulp=0.1951
     3.9201165215e-01f,  // Idx 22 ulp=0.4143
     3.9414023666e-01f,  // Idx 23 ulp=0.3708
     3.9628037917e-01f,  // Idx 24 ulp=0.4436
     3.9843214244e-01f,  // Idx 25 ulp=0.3522
     4.0059558957e-01f,  // Idx 26 ulp=0.2483
     4.0277078401e-01f,  // Idx 27 ulp=0.4460
     4.0495778954e-01f,  // Idx 28 ulp=0.3606
     4.0715667029e-01f,  // Idx 29 ulp=0.4212
     4.0936749075e-01f,  // Idx 30 ulp=0.3964
     4.1159031574e-01f,  // Idx 31 ulp=0.2185
     4.1382521045e-01f,  // Idx 32 ulp=0.3688
     4.1607224043e-01f,  // Idx 33 ulp=0.4600
     4.1833147155e-01f,  // Idx 34 ulp=0.2933
     4.2060297007e-01f,  // Idx 35 ulp=0.4483
     4.2288680260e-01f,  // Idx 36 ulp=0.3963
     4.2518303612e-01f,  // Idx 37 ulp=0.2455
     4.2749173797e-01f,  // Idx 38 ulp=0.3282
     4.2981297583e-01f,  // Idx 39 ulp=0.4720
     4.3214681779e-01f,  // Idx 40 ulp=0.3888
     4.3449333227e-01f,  // Idx 41 ulp=0.3113
     4.3685258810e-01f,  // Idx 42 ulp=0.4387
     4.3922465445e-01f,  // Idx 43 ulp=0.4385
     4.4160960089e-01f,  // Idx 44 ulp=0.3205
     4.4400749736e-01f,  // Idx 45 ulp=0.2366
     4.4641841416e-01f,  // Idx 46 ulp=0.3474
     4.4884242201e-01f,  // Idx 47 ulp=0.4534
     4.5127959197e-01f,  // Idx 48 ulp=0.4455
     4.5372999553e-01f,  // Idx 49 ulp=0.3493
     4.5619370454e-01f,  // Idx 50 ulp=0.2858
     4.5867079124e-01f,  // Idx 51 ulp=0.3697
     4.6116132828e-01f,  // Idx 52 ulp=0.4486
     4.6366538869e-01f,  // Idx 53 ulp=0.4774
     4.6618304590e-01f,  // Idx 54 ulp=0.4085
     4.6871437374e-01f,  // Idx 55 ulp=0.3447
     4.7125944644e-01f,  // Idx 56 ulp=0.2860
     4.7381833863e-01f,  // Idx 57 ulp=0.2415
     4.7639112536e-01f,  // Idx 58 ulp=0.2926
     4.7897788206e-01f,  // Idx 59 ulp=0.3385
     4.8157868459e-01f,  // Idx 60 ulp=0.3793
     4.8419360923e-01f,  // Idx 61 ulp=0.4148
     4.8682273265e-01f,  // Idx 62 ulp=0.4451
     4.8946613195e-01f,  // Idx 63 ulp=0.4701
     4.9179103568e-01f,  // Idx 64 ulp=0.4899
     4.9446141237e-01f,  // Idx 65 ulp=0.4957
     4.9714628894e-01f,  // Idx 66 ulp=0.4866
     4.9984574413e-01f,  // Idx 67 ulp=0.4830
     5.0255985709e-01f,  // Idx 68 ulp=0.4847
     5.0528870742e-01f,  // Idx 69 ulp=0.4918
     5.0803237513e-01f,  // Idx 70 ulp=0.4955
     5.1079094069e-01f,  // Idx 71 ulp=0.4774
     5.1356448499e-01f,  // Idx 72 ulp=0.4537
     5.1635308936e-01f,  // Idx 73 ulp=0.4245
     5.1915683557e-01f,  // Idx 74 ulp=0.3897
     5.2197580585e-01f,  // Idx 75 ulp=0.3901
     5.2481008286e-01f,  // Idx 76 ulp=0.4347
     5.2765974972e-01f,  // Idx 77 ulp=0.4851
     5.3052488998e-01f,  // Idx 78 ulp=0.4589
     5.3340558767e-01f,  // Idx 79 ulp=0.4030
     5.3630192726e-01f,  // Idx 80 ulp=0.4749
     5.3921399369e-01f,  // Idx 81 ulp=0.4474
     5.4214187236e-01f,  // Idx 82 ulp=0.3647
     5.4508564911e-01f,  // Idx 83 ulp=0.4526
     5.4804541029e-01f,  // Idx 84 ulp=0.4535
     5.5064820514e-01f,  // Idx 85 ulp=0.3708
     5.5326371617e-01f,  // Idx 86 ulp=0.4751
     5.5626788343e-01f,  // Idx 87 ulp=0.4146
     5.5928836303e-01f,  // Idx 88 ulp=0.4220
     5.6232524354e-01f,  // Idx 89 ulp=0.4571
     5.6537861400e-01f,  // Idx 90 ulp=0.3875
     5.6844856397e-01f,  // Idx 91 ulp=0.4810
     5.7153518346e-01f,  // Idx 92 ulp=0.4860
     5.7463856299e-01f,  // Idx 93 ulp=0.3748
     5.7775879356e-01f,  // Idx 94 ulp=0.4720
     5.8089596668e-01f,  // Idx 95 ulp=0.3970
     5.8424792687e-01f,  // Idx 96 ulp=0.4389
     5.8742033534e-01f,  // Idx 97 ulp=0.4664
     5.9060996967e-01f,  // Idx 98 ulp=0.4992
     5.9381692340e-01f,  // Idx 99 ulp=0.4630
     5.9704129057e-01f,  // Idx 100 ulp=0.4304
     6.0028316574e-01f,  // Idx 101 ulp=0.4774
     6.0354264397e-01f,  // Idx 102 ulp=0.4707
     6.0681982085e-01f,  // Idx 103 ulp=0.4961
     6.1011479247e-01f,  // Idx 104 ulp=0.4376
     6.1342765546e-01f,  // Idx 105 ulp=0.4804
     6.1654969396e-01f,  // Idx 106 ulp=0.4440
     6.1968783502e-01f,  // Idx 107 ulp=0.4821
     6.2305267868e-01f,  // Idx 108 ulp=0.4984
     6.2643579311e-01f,  // Idx 109 ulp=0.4396
     6.2983727752e-01f,  // Idx 110 ulp=0.4611
     6.3325723166e-01f,  // Idx 111 ulp=0.4852
     6.3685671457e-01f,  // Idx 112 ulp=0.4692
     6.4026130293e-01f,  // Idx 113 ulp=0.4925
     6.4373785849e-01f,  // Idx 114 ulp=0.4700
     6.4723329140e-01f,  // Idx 115 ulp=0.4878
     6.5074770417e-01f,  // Idx 116 ulp=0.4625
     6.5417043016e-01f,  // Idx 117 ulp=0.4772
     6.5761127536e-01f,  // Idx 118 ulp=0.4943
     6.6118203956e-01f,  // Idx 119 ulp=0.4836
     6.6491138744e-01f,  // Idx 120 ulp=0.4799
     6.6843839925e-01f,  // Idx 121 ulp=0.4807
     6.7201106027e-01f,  // Idx 122 ulp=0.4878
     6.7560287735e-01f,  // Idx 123 ulp=0.4991
     6.7939879697e-01f,  // Idx 124 ulp=0.4914
     6.8295969567e-01f,  // Idx 125 ulp=0.4935
     6.8674512579e-01f,  // Idx 126 ulp=0.4996
     6.9055288531e-01f  // Idx 127 ulp=0.4996
};

// Intercept coefficients (b)
static const float coeffs_b[LUT_SIZE] = {
     8.4798046051e-01f,
     8.4985152262e-01f,
     8.5171790239e-01f,
     8.5357949380e-01f,
     8.5543618982e-01f,
     8.5728788240e-01f,
     8.5913446247e-01f,
     8.6097581991e-01f,
     8.6281184355e-01f,
     8.6464242118e-01f,
     8.6646743953e-01f,
     8.6828678425e-01f,
     8.7010033992e-01f,
     8.7190799003e-01f,
     8.7370961698e-01f,
     8.7550510205e-01f,
     8.7729432544e-01f,
     8.7907716619e-01f,
     8.8085350225e-01f,
     8.8262321041e-01f,
     8.8438616632e-01f,
     8.8614224448e-01f,
     8.8789131820e-01f,
     8.8963325966e-01f,
     8.9136793983e-01f,
     8.9309522848e-01f,
     8.9481499421e-01f,
     8.9652710440e-01f,
     8.9823142519e-01f,
     8.9992782152e-01f,
     9.0161615707e-01f,
     9.0329629431e-01f,
     9.0496809440e-01f,
     9.0663141729e-01f,
     9.0828612161e-01f,
     9.0993206473e-01f,
     9.1156910271e-01f,
     9.1319709033e-01f,
     9.1481588102e-01f,
     9.1642532692e-01f,
     9.1802527881e-01f,
     9.1961558613e-01f,
     9.2119609698e-01f,
     9.2276665808e-01f,
     9.2432711478e-01f,
     9.2587731103e-01f,
     9.2741708942e-01f,
     9.2894629108e-01f,
     9.3046475577e-01f,
     9.3197232179e-01f,
     9.3346882602e-01f,
     9.3495410388e-01f,
     9.3642798933e-01f,
     9.3789031486e-01f,
     9.3934091148e-01f,
     9.4077960870e-01f,
     9.4220623452e-01f,
     9.4362061543e-01f,
     9.4502257639e-01f,
     9.4641194083e-01f,
     9.4778853060e-01f,
     9.4915216603e-01f,
     9.5050266583e-01f,
     9.5183984716e-01f,
     9.5299905119e-01f,
     9.5431076201e-01f,
     9.5560861970e-01f,
     9.5689243513e-01f,
     9.5816201754e-01f,
     9.5941717452e-01f,
     9.6065771197e-01f,
     9.6188343413e-01f,
     9.6309414352e-01f,
     9.6428964097e-01f,
     9.6546972559e-01f,
     9.6663419474e-01f,
     9.6778284406e-01f,
     9.6891546741e-01f,
     9.7003185688e-01f,
     9.7113180278e-01f,
     9.7221509363e-01f,
     9.7328151613e-01f,
     9.7433085514e-01f,
     9.7536289370e-01f,
     9.7637741299e-01f,
     9.7725008935e-01f,
     9.7811000118e-01f,
     9.7907519893e-01f,
     9.8002204010e-01f,
     9.8095029690e-01f,
     9.8185973959e-01f,
     9.8275013648e-01f,
     9.8362125392e-01f,
     9.8447285628e-01f,
     9.8530470597e-01f,
     9.8611656335e-01f,
     9.8695704570e-01f,
     9.8772690349e-01f,
     9.8847602251e-01f,
     9.8920415485e-01f,
     9.8991105051e-01f,
     9.9059645739e-01f,
     9.9126012129e-01f,
     9.9190178588e-01f,
     9.9252119267e-01f,
     9.9311808104e-01f,
     9.9365670628e-01f,
     9.9417563593e-01f,
     9.9470631227e-01f,
     9.9521343954e-01f,
     9.9569674638e-01f,
     9.9615595913e-01f,
     9.9661043094e-01f,
     9.9701342952e-01f,
     9.9739791183e-01f,
     9.9775717377e-01f,
     9.9809093012e-01f,
     9.9838951826e-01f,
     9.9866392553e-01f,
     9.9892108720e-01f,
     9.9915985008e-01f,
     9.9935812727e-01f,
     9.9953140087e-01f,
     9.9967812707e-01f,
     9.9980303112e-01f,
     9.9989262593e-01f,
     9.9995825320e-01f,
     9.9999414127e-01f
};

/**
 * @brief Calculate LUT index from input value.
 * 
 * @param x Input value in [-0.99609375, -0.001953125]
 * @return int LUT index [0, 127]
 */
inline int get_lut_index(float x) {
    float normalized = (x - INTERVAL_START) / (INTERVAL_END - INTERVAL_START);
    int idx = static_cast<int>(normalized * LUT_SIZE);
    // Clamp to valid range
    if (idx < 0) idx = 0;
    if (idx >= LUT_SIZE) idx = LUT_SIZE - 1;
    return idx;
}

/**
 * @brief Compute exp2(x) approximation using LUT.
 * 
 * @param x Input value in [-0.99609375, -0.001953125]
 * @return float Approximation of 2^x
 */
inline float exp2_approx(float x) {
    int idx = get_lut_index(x);
    return coeffs_a[idx] * x + coeffs_b[idx];
}

} // namespace bf16_exp2

#endif // BF16_EXP2_COEFFS_HPP
