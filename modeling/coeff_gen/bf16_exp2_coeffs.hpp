#ifndef BF16_EXP2_COEFFS_HPP
#define BF16_EXP2_COEFFS_HPP

#include <cstdint>

// =============================================================
// exp2(x) Linear Approximation Coefficients for BF16
// =============================================================
//
// Generated: 2025-12-23 15:06:39
// Interval:  [-0.99609375, -0.001953125]
// LUT Size:  64
//
// Approximation: y = a * x + b
//
// Error Metrics (BF16 ULP):
//   Worst-case: 0.499632 ULP
//   Average:    0.262881 ULP
// =============================================================

namespace bf16_exp2 {

constexpr int LUT_SIZE = 64;
constexpr float INTERVAL_START = -0.99609375f;
constexpr float INTERVAL_END = -0.001953125f;

// Slope coefficients (a)
static const float coeffs_a[LUT_SIZE] = {
     3.5562485264e-01f,  // [-0.996094, -0.929688] ulp=0.4869
     3.7338621079e-01f,  // [-0.925781, -0.859375] ulp=0.4889
     3.9203464374e-01f,  // [-0.855469, -0.789062] ulp=0.4875
     4.1161445562e-01f,  // [-0.785156, -0.718750] ulp=0.4600
     4.3217216331e-01f,  // [-0.714844, -0.648438] ulp=0.4720
     4.5375660692e-01f,  // [-0.644531, -0.578125] ulp=0.4774
     4.7641906583e-01f,  // [-0.574219, -0.507812] ulp=0.4451
     4.9590376621e-01f,  // [-0.503906, -0.468750] ulp=0.4957
     5.0735222459e-01f,  // [-0.466797, -0.433594] ulp=0.4955
     5.1986748419e-01f,  // [-0.431641, -0.398438] ulp=0.4347
     5.3269146762e-01f,  // [-0.396484, -0.363281] ulp=0.4851
     5.4583179043e-01f,  // [-0.361328, -0.328125] ulp=0.4535
     5.5929625599e-01f,  // [-0.326172, -0.292969] ulp=0.4751
     5.7309286020e-01f,  // [-0.291016, -0.257812] ulp=0.4860
     5.8460890950e-01f,  // [-0.255859, -0.236328] ulp=0.4389
     5.9802483481e-01f,  // [-0.235352, -0.218750] ulp=0.4992
     5.9947283577e-01f,  // [-0.217773, -0.201172] ulp=0.4774
     6.0682162812e-01f,  // [-0.200195, -0.183594] ulp=0.4961
     6.1426050753e-01f,  // [-0.182617, -0.166016] ulp=0.4804
     6.2179057837e-01f,  // [-0.165039, -0.148438] ulp=0.4984
     6.2941295852e-01f,  // [-0.147461, -0.130859] ulp=0.4852
     6.3590453780e-01f,  // [-0.129883, -0.119141] ulp=0.4692
     6.4026142761e-01f,  // [-0.118652, -0.110352] ulp=0.4925
     6.4417387859e-01f,  // [-0.109863, -0.101562] ulp=0.4828
     6.4811023743e-01f,  // [-0.101074, -0.092773] ulp=0.4878
     6.5207065020e-01f,  // [-0.092285, -0.083984] ulp=0.4772
     6.5605526391e-01f,  // [-0.083496, -0.075195] ulp=0.4943
     6.6006422642e-01f,  // [-0.074707, -0.066406] ulp=0.4926
     6.6357048491e-01f,  // [-0.065918, -0.060059] ulp=0.4799
     6.6595412376e-01f,  // [-0.059814, -0.055664] ulp=0.3968
     6.6798575060e-01f,  // [-0.055420, -0.051270] ulp=0.4807
     6.7002357533e-01f,  // [-0.051025, -0.046875] ulp=0.4806
     6.7206761685e-01f,  // [-0.046631, -0.042480] ulp=0.4878
     6.7411789412e-01f,  // [-0.042236, -0.038086] ulp=0.3860
     6.7617442618e-01f,  // [-0.037842, -0.033691] ulp=0.4991
     6.7803066273e-01f,  // [-0.033447, -0.030273] ulp=0.4856
     6.7929961450e-01f,  // [-0.030151, -0.028076] ulp=0.2947
     6.8033499542e-01f,  // [-0.027954, -0.025879] ulp=0.4488
     6.8137195444e-01f,  // [-0.025757, -0.023682] ulp=0.4914
     6.8241049399e-01f,  // [-0.023560, -0.021484] ulp=0.2159
     6.8345061647e-01f,  // [-0.021362, -0.019287] ulp=0.4935
     6.8449232430e-01f,  // [-0.019165, -0.017090] ulp=0.3783
     6.8546404785e-01f,  // [-0.016968, -0.015259] ulp=0.3067
     6.8613039955e-01f,  // [-0.015198, -0.014160] ulp=0.4996
     6.8665309661e-01f,  // [-0.014099, -0.013062] ulp=0.4896
     6.8717619187e-01f,  // [-0.013000, -0.011963] ulp=0.2965
     6.8769968562e-01f,  // [-0.011902, -0.010864] ulp=0.1032
     6.8822357817e-01f,  // [-0.010803, -0.009766] ulp=0.2730
     6.8874786983e-01f,  // [-0.009705, -0.008667] ulp=0.4667
     6.8925224115e-01f,  // [-0.008606, -0.007690] ulp=0.4990
     6.8960068832e-01f,  // [-0.007660, -0.007141] ulp=0.3556
     6.8986330868e-01f,  // [-0.007111, -0.006592] ulp=0.2586
     6.9012602906e-01f,  // [-0.006561, -0.006042] ulp=0.1616
     6.9038884949e-01f,  // [-0.006012, -0.005493] ulp=0.0646
     6.9065177001e-01f,  // [-0.005463, -0.004944] ulp=0.1242
     6.9091479066e-01f,  // [-0.004913, -0.004395] ulp=0.2214
     6.9117422244e-01f,  // [-0.004364, -0.003876] ulp=0.3132
     6.9135703524e-01f,  // [-0.003860, -0.003601] ulp=0.3618
     6.9148866732e-01f,  // [-0.003586, -0.003326] ulp=0.4104
     6.9162032447e-01f,  // [-0.003311, -0.003052] ulp=0.4591
     6.9175200669e-01f,  // [-0.003036, -0.002777] ulp=0.4996
     6.9188371397e-01f,  // [-0.002762, -0.002502] ulp=0.4896
     6.9201544634e-01f,  // [-0.002487, -0.002228] ulp=0.4410
     6.9214720378e-01f  // [-0.002213, -0.001953] ulp=0.3923
};

// Intercept coefficients (b)
static const float coeffs_b[LUT_SIZE] = {
     8.5550642129e-01f,
     8.7198018945e-01f,
     8.8796550696e-01f,
     9.0337249102e-01f,
     9.1810349899e-01f,
     9.3205257749e-01f,
     9.4510487582e-01f,
     9.5500052169e-01f,
     9.6036939820e-01f,
     9.6578300037e-01f,
     9.7087930100e-01f,
     9.7563935165e-01f,
     9.8004346211e-01f,
     9.8407117540e-01f,
     9.8705133201e-01f,
     9.9006803785e-01f,
     9.9043180106e-01f,
     9.9190647827e-01f,
     9.9326847164e-01f,
     9.9451479683e-01f,
     9.9564241326e-01f,
     9.9649427826e-01f,
     9.9701374359e-01f,
     9.9744451952e-01f,
     9.9784333090e-01f,
     9.9820977099e-01f,
     9.9854342926e-01f,
     9.9884389140e-01f,
     9.9907715315e-01f,
     9.9922055769e-01f,
     9.9933339648e-01f,
     9.9943762422e-01f,
     9.9953318733e-01f,
     9.9962003196e-01f,
     9.9969810404e-01f,
     9.9976068516e-01f,
     9.9979919555e-01f,
     9.9982820165e-01f,
     9.9985497350e-01f,
     9.9987950420e-01f,
     9.9990178686e-01f,
     9.9992181458e-01f,
     9.9993841143e-01f,
     9.9994861174e-01f,
     9.9995599723e-01f,
     9.9996281366e-01f,
     9.9996906016e-01f,
     9.9997473584e-01f,
     9.9997983985e-01f,
     9.9998420329e-01f,
     9.9998689429e-01f,
     9.9998876568e-01f,
     9.9999049347e-01f,
     9.9999207754e-01f,
     9.9999351779e-01f,
     9.9999481411e-01f,
     9.9999595094e-01f,
     9.9999666363e-01f,
     9.9999713664e-01f,
     9.9999757358e-01f,
     9.9999797444e-01f,
     9.9999833920e-01f,
     9.9999866785e-01f,
     9.9999896037e-01f
};

/**
 * @brief Calculate LUT index from input value.
 * 
 * @param x Input value in [-0.99609375, -0.001953125]
 * @return int LUT index [0, 63]
 */
inline int get_lut_index(float x) {
    float normalized = (x - INTERVAL_START) / (INTERVAL_END - INTERVAL_START);
    int idx = static_cast<int>(normalized * LUT_SIZE);
    // Clamp to valid range
    if (idx < 0) idx = 0;
    if (idx >= LUT_SIZE) idx = LUT_SIZE - 1;
    return idx;
}

/**
 * @brief Compute exp2(x) approximation using LUT.
 * 
 * @param x Input value in [-0.99609375, -0.001953125]
 * @return float Approximation of 2^x
 */
inline float exp2_approx(float x) {
    int idx = get_lut_index(x);
    return coeffs_a[idx] * x + coeffs_b[idx];
}

} // namespace bf16_exp2

#endif // BF16_EXP2_COEFFS_HPP
